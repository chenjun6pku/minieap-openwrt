name: Build minieap IPK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:   # 允许手动触发

jobs:
  build:
    name: Build for ${{ matrix.arch }}
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        arch:           # 你需要哪些架构就加哪些，常用几个如下
          - x86_64-24.10.0
          - mips_24kc-24.10.0     # 很多小米路由器
          - mipsel_24kc-24.10.0
          - aarch64_generic-24.10.0
          - arm_cortex-a7-24.10.0
          # ... 根据需要自行增加

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 最重要的步骤：使用官方 action
      - name: Build package with official OpenWrt SDK
        uses: openwrt/gh-action-sdk@main
        env:
          ARCH: ${{ matrix.arch }}
          # 可选参数（一般不需要改）
          # FEEDNAME: minieap
          # EXTRA_FEEDS: "src-link minieap $(pwd)"
          # INDEX: 1           # 是否生成 Packages 索引文件
          # IGNORE_ERRORS: 1   # 允许部分包失败（一般不用）

      # 上传产物（强烈推荐）
      - name: Upload IPK artifacts
        uses: actions/upload-artifact@v4
        with:
          name: minieap-${{ matrix.arch }}
          path: bin/packages/${{ matrix.arch }}/minieap/*.ipk
          if-no-files-found: error
