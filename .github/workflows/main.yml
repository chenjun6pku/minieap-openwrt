name: Build Minieap IPK (BoringCat)

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:  # 手动触发

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        arch: 
          - x86_64
          - mipsel_24kc
          - armvirt_64
          - aarch64_cortex-a53
          # 可继续添加如 mediatek_filogic 等（查看 https://downloads.openwrt.org/releases/24.10.5/targets/）

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build with OpenWrt SDK (24.10 latest)
        uses: openwrt/gh-action-sdk@main
        with:
          packages: minieap  # 指定要编译的包名（Makefile 中的 PKG_NAME:=minieap）
        env:
          ARCH: ${{ matrix.arch }}  # 只用纯架构名，默认最新 24.10.x SDK
          DOWNLOADS_CACHE: true     # 缓存下载，第二次构建更快
          V: s                      # 详细日志，便于调试

      - name: Upload IPK Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: minieap-ipk-${{ matrix.arch }}
          path: bin/packages/${{ matrix.arch }}/base/minieap_*.ipk
          retention-days: 14  # 保留长一点，便于下载
